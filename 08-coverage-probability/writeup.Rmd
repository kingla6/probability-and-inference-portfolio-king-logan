---
title: "R Notebook"
output:
  html_document:
    code_folding: hide
    toc_float: TRUE
---

Coverage Probability
====================

Assignment
--------------------------------------------------------------------------------
In this assignment, you will perform a simulation to calculate the
coverage probability of the 95% confidence interval of the median when
computed from *FÌ‚*<sub>*X*</sub><sup>*m**l**e*</sup>. You will write a
blog post to explain coverage probability and to explain your
simulation.

The audience of your blog post is a Senior Data Scientist who you hope
to work with in the future.
--------------------------------------------------------------------------------

When sampling from a distribution, one is typically concerned with the reliability of their samples. One way to confirm the reliability of one's samples is by analyzing the coverage probability of a sampling distribution. Coverage probability is the long run proportion of intervals that capture the population parameter of interest. The following post will walk through the calculation of coverage probability for the sampling distribution of medians from a normal distribution.

```{r}
library(tidyverse)
library(stats4)
```

We begin by taking a sample of size 201 from the standard normal distribution. We the attempt to estimate the overall distribution using this sample, our method of estimation is maximum likelihood estimation (MLE). MLE uses features of the sample to estimate the overall distribution. Since we are attempting to estimate the normal distribution, the population mean and standard deviation are estimated using the sample.

```{r}
set.seed(1234)
n <- 201
samp <- rnorm(n)

mle_mean <- mean(samp)
mle_sd <- sqrt(((n - 1) / n) * var(samp))

hist(samp, freq = F)
curve(dnorm(x, mle_mean, mle_sd), add = T, col = 'blue')
```

From the sample, we generate a histogram and overlay that with the estimation of the distribution that was generated using MLE. Although the fit generated by the MLE does not perfectly match the sample, this is to be expected due to variation from sample to sample. If we were to increase the size of the sample, the MLE estimate should provide a better fit. 

Using the estimate of the distribution generated by MLE, we are able to approximate a sampling distribution. We generate a sampling distribution of the medians by the B + Q shortcut, a computational shortcut meant for generating sampling distributions. The B + Q shortcut takes the beta distribution with parameters of the order statistic of interest and uses it as probability inputs for the quantile function of our original distribution of interest. Below, we conduct use the B + Q shortcut to generate a sampling distribution of the medians of size 1000.  

```{r}
m <- 1000
meds = NULL

meds = rbeta(m, 101, 101) %>% qnorm(mean = mle_mean, sd = mle_sd)

hist(meds)
```

The histogram of the sampling distribution generated shows that the median is most concentrated between -0.1 and 0.

Taking the quantiles of our sampling distribution at 0.025 and 97.5 allows us to calculate its 95% confidence interval.

```{r}
ci = quantile(meds, c(.025, .975))

ci
```

We want the confidence interval of our sampling distribution to contain 0, because that is the median of a standard normal distribution. We see that 0 was contained within our confidence interval for this distribution. 

To calculate coverage probability, we repeat the above steps many times. In other words, determine the long run proportion of intervals that capture the population parameter of interest. To do this, we create a function which implements the steps we saw above. 

Our function takes the inputs m (the size of our sampling distribution), n (the size of our sample from the normal distribution), and param_int (the value that should be contained by our confidence interval). We begin by taking a sample of size n from the standard normal distribution. Following that, we calculate the order statistic for the median based on the sample size. We then generate our MLE estimates based on the sample. Next, we generate a sampling distribution of the medians. Finally, we generate a confidence interval and determine whether or not our value of interest is contained within the confidence interval. The default values for our function are m = 5000, n = 201, and param_int = 0. The function is built to determine the coverage for the standard normal distribution's median, but could be reconfigured to analyze other summary statistics or distributions.  

```{r}
gen_ci_med <- function(m = 5000, n = 201, param_int = 0) {
  samp = rnorm(n)
  med = ceiling(n / 2)
  
  mle_mean = mean(samp)
  mle_sd = sqrt(((n - 1) / n) * var(samp))
  
  meds = rbeta(m, med, med) %>% qnorm(mean = mle_mean, sd = mle_sd)
  
  ci = quantile(meds, c(.025, .975))

  (ci[1] < param_int & ci[2] > param_int)
}
```

```{r}
set.seed(1234)
ci_contain <- NA
for(i in 1:10000) {
  ci_contain[i] = gen_ci_med()
}
```

Since our function only determines the coverage of one sampling distribution, we use simulation to repeat this process to determine coverage probability. When simulating 10000 times, we find the coverage probability to be `r mean(ci_contain)`. This is ideal, as a 95% confidence interval will capture the population parameter
of interest in about 95% of samples.

If we alter the parameters of the simulation, we could learn more about the operating characteristics of our method for constructing the 95% confidence interval. We are able to alter both the size of our original sample and the size of our sampling distribution. Increasing both of these would increase our coverage probability as larger sample sizes push our samples closer to the actual distribution. Altering our value that should be contained in the confidence interval to anything other than 0 would decrease the coverage probability, as 0 is the actual value for the median of a standard normal distribution. The param_int variable's influence on the coverage probability depends on what the summary statistic of interest is for the coverage probability based on teh way our function was built.
