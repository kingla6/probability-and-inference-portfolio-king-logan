---
title: "writeup"
author: "Logan King"
date: "10/19/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
```

Which quantiles of a continuous distribution can one estimate with more precision?
==================================================================================

The median is an important quantity in data analysis. It represents the
middle value of the data distribution. Estimates of the median, however,
have a degree of uncertainty because (a) the estimates are calculated
from a finite sample and (b) the data distribution of the underlying
data is generally unknown. One important role of a data scientist is to
quantify and to communicate the degree of uncertainty in his or her data
analysis.

Questions
---------

**Q:** Begin with the median from a sample of *N* = 200 from the
standard normal distribution. Write an R function that is the density
function for the median in this sample. Note that the 100th order
statistic is approximately the median, and use the order statistic
formula discussed in class. Generate a plot of the function.

For this question, a function that creates random draws from a normal distribution is necessary. We use the mathematical formula that is given for the distribution of X~(k)~. The inputs for our coded function are:
x - the set of values that are tested for our order statistic of interest, n - the sample size, and k - our order statistic of interest. The inclusion of all these variables as inputs allows for our function to be tested for several different order statistics. Since our order statistic of interest is the median, k should take a value of n/2. Our function is limited in that it is only applicable to the standard normal distribution. The result is a density plot of the sample medians of a standard normal distribution. We see that the density of medians is greatest at 0 and does not take on values outside of [-.5, .5]. 

<details>
  <summary>See code here:</summary>
```{r first dorder code}
dorder <- function(x, n, k){
  k *
    choose(n, k) * 
    ((pnorm(x)) ^ (k-1)) *
    ((1 - pnorm(x)) ^ (n-k)) *
    dnorm(x)
}
```
</details>

```{r first dorder plot, echo=FALSE}
x <- seq(-1, 1, by = .01)
plot(x, dorder(x, 200, 100), 
     type = 'l', 
     main = 'Density Plot of Sample Medians of Standard Normal Distibution',
     xlab = 'Median',
     ylab = 'Density')
```

**Q:** Write an R function that is the probability function for the
median in this sample. Use the order statistic formula discussed in
class. Generate a plot of the function.

The following function takes similar inputs to the first function, but instead plots a CDF of the sample medians of the standard normal distribution. The inputs of x, n, and k remain the same as the previous plot, but instead of plugging these inputs into a distribution formula for X~(k)~ which outputs densities, we plug them into a formula to generate probabilities which form a CDF. We see the cumulative probability for the median begin to rise from -.5 to 0 and reach 100% prior to reaching .5. 

<details>
  <summary>See code here:</summary>
```{r first porder code}
porder <- function(x, n, k){
  pbinom(k - 1, n, pnorm(x), lower.tail = F)
}
```
</details>

```{r forst porder plot, echo=FALSE}
curve(porder(x, 200, 100),
      -1, 1,
      xlab = 'Median',
      ylab = 'Probability',
      main = 'CDF of Sample Medians of Standard Normal Distribution')
```

**Q:** Write an R function that is the quantile function for the median
in this sample. (You have several options for how to write this
function.) Generate a plot of the function.

The quantile function is similar to our porder function that was previously defined. This function is simply the inverse of the porder function, as it takes in probabilities (p) instead of possible median values (x). The inputs are now p, n, k. The uniroot function applied to our porder function allows us to invert the porder function and input probabilities for an output which builds a quantile plot. Again, this will only be applicable to the standard normal distribution based on the construction of previous functions. The quantile plot provides a clearer interpretation of the values which the median can take on, we see that the sample median of a standard normal distribution will generally lie between -.2 and .2. 

<details>
  <summary>See code here:</summary>
```{r first qorder code}
qorder <- function(p, n, k){
  out <- p
  for(i in seq_along(p)){
    out[i] <- uniroot(function(x){porder(x, n, k) - p[i]}, c(-100,100))$root
  }
  out
}
```
</details>

```{r first qorder plot, echo=FALSE}
p <- seq(.01, .99, by = .01)
plot(p, qorder(p, 200, 100), 
     type = 'l',
     xlab = 'Probability',
     ylab = 'Median',
     main = 'Quantile Plot of Sample Medians of Standard Normal Distribution')
```

**Q:** Simulate the sampling distribution for the median. Create a plot
of the empirical CDF (ECDF). Overlay the plot of the ECDF with a plot of
the CDF.

Here, we compare the CDF generated by the porder function (analytic method) with the ECDF generated via simulation. To build the simulated sample, we take the median of a sample of size 200 from a standard normal distribution (this is replicated 10000 times). An ECDF of the sample medians is plotted alongside the analytical CDF from our porder function and we see that the two are similar, however the ECDF is shifted slightly right - meaning our samples take on slightly higher median values (this is an example of simulation error).

<details>
  <summary>See code here:</summary>
```{r simulation code}
set.seed(1000)
samp = NA

for(i in 1:10000) {
  data = rnorm(200)
  samp[i] = median(data)
}
```
</details>

```{r ECDF vs CDF plot, echo=FALSE}
plot(ecdf(samp), col = 'red',
     main = 'ECDF (red) vs CDF (blue) for Sample Medians of Standard Normal Dist',
     xlab = 'Median',
     ylab = 'Probability')
curve(porder(x, 200, 100), -1, 1, col = 'blue', add = T)
```

**Q:** Using the simulated sampling distribution from the previous
question, create a histogram (on the density scale). Overlay the
histogram with a plot of the density function.

The following plot generates a histogram of the previously simulated data along with an analytic density plot that is generated by the porder function. We observe that the histogram does not perfectly follow the density and tends to hold higher median values than the analytic method confirming what we observed in the previous ECDF vs CDF plot. 

```{r Hist vs PDF, echo=FALSE}
hist(samp, freq = F, ylim = c(0,5), breaks = 25,
     main = 'Simulated Density Histogram vs. Analytical Density Function',
     xlab = 'Median')
curve(dorder(x, 200, 100), add = T)
```


**Q:** One very common way to compare a random sample to a theoretical
candidate distribution is the QQ plot. It is created by ploting
quantiles of the theoretical distribution on the x-axis and empirical
quantiles from the sample on the y-axis. Generate a QQ plot for the simulated data of the
median relative to the known sampling distribution of the median. Does the simulated data agree with the theoretical sampling distribution?

To generate the below QQ plot, we compare the theoretical quantiles (generated by our qorder function) for sample medians to the simulated sample medians. The sample medians are computed by applying the quantile function to our previously generated sample medians. The resulting QQ plot confirms our findings from the previous simulation vs analytic (theoretical) plots. While the distributions are similar and generally agree, we observe slightly higher values in the simulated medians - again, simulation error. 

<details>
  <summary>See code here:</summary>
```{r qq data code}
p <- ppoints(200)
theoretical = qorder(p, 200, 100)
simulated = quantile(samp, probs = p)
```
</details>

```{r median qq plot, echo=FALSE}
qqplot(theoretical,simulated,
       main = 'QQ Plot of Theoretical vs Simulated Sample Medians')
abline(0,1)
```

**Q:** Modify the `dorder`, `porder`, and `qorder` functions so that the
functions take a new parameter `k` (for the *k*<sup>*t**h*</sup> order
statistic) so that the functions will work for any order statistic and
not just the median.

The functions were already built with the capability to handle order statistics other than the median. For median: k = n/2, for minimum: k = 1, for maximum: k = n, and so on. 

**Q:** Generate the QQ plot for simulated data from the sampling
distribution of the sample max and the theoretical largest order
statistic distribution.

We follow the same exact process as above when generating the QQ plot for simulated vs. theoretical sample maximums, with one change - we are taking the max of each sample instead of the median. This is reflected in our simulation code by using max() instead of median() and in our theoretical code by setting k = 200 instead of 100. From the QQ plot, we see that the simulated data and theoretical data appear to agree very well, as almost every point lies along the identity line. 

<details>
  <summary>See code here:</summary>
```{r qq max data code}
set.seed(1000)
samp = NA

for(i in 1:10000) {
  data = rnorm(200)
  samp[i] = max(data)
}

p <- ppoints(200)
theoretical = qorder(p, 200, 200)
simulated = quantile(samp, probs = p)
```
</details>


```{r max qq plot, echo=FALSE}
qqplot(theoretical,simulated,
       main = 'QQ Plot of Theoretical vs Simulated Sample Max')
abline(0,1)
```


**Q:** Modify the `dorder`, `porder`, and `qorder` functions so that the
functions take new parameters `dist` and `...` so that the functions
will work for any continuous distribution that has `d` and `p` functions
defined in R.

To alter our functions in order to fit other distributions, we must add arguments for dist (to fit a new distribution shape) and ... (to satisfy any input requirements for other distributions). The dist input is fed into a paste function to generate the pdist and ddist dunctions where necessary (ex: pnorm and dnorm for dist = 'norm'). The ... argument is included within these functions to capture any extra necessary arguments. We are now able to explore operating statistics for any type of distribution.

<details>
  <summary>See code here:</summary>
```{r updated functions}
dorder <- function(x, n, k, dist = 'norm', ...) {
  pf <- get(paste0('p', dist))
  df <- get(paste0('d', dist))
  
  k *
    choose(n, k) * 
    ((pf(x, ...)) ^ (k-1)) *
    ((1 - pf(x, ...)) ^ (n-k)) *
    df(x, ...)
}

porder <- function(x, n, k, dist = 'norm', ...) {
  pf <- get(paste0('p', dist))
  pbinom(k - 1, n, pf(x, ...), lower.tail = F)
}

qorder <- function(x, n, k, dist = 'norm', ...) {
  out <- p
  for(i in seq_along(p)){
    out[i] <- uniroot(function(x){porder(x, n, k, dist = 'norm', ...) - p[i]}, c(-100,100))$root
  }
  out  
}
```
</details>

**Q:** Use the newly modified functions to plot the probability and
density functions for the sample min (*N* = 200).

Below, we plot the PDF and CDF of the sample minimums of a standard normal distribution (no further inputs are needed as it is the functions' default). We observe the PDF as slightly skewed and having the highest density between -3 and -2. The CDF shows that the cumulative probability for the sample minimums beginning to rise after -5 and reaching 100% by -1. 

```{r minimum pdf, echo=FALSE}
x <- seq(-5, -1, by = .01)
plot(x, dorder(x, n = 200, k = 1), 
     type = 'l', 
     main = 'Density Plot of Sample Minimums of Standard Normal Distibution',
     xlab = 'Minimum',
     ylab = 'Density')
```

```{r minimum cdf, echo=FALSE}
curve(porder(x, n = 200, k = 1),
      -5, -1,
      xlab = 'Minimum',
      ylab = 'Probability',
      main = 'CDF of Sample Minimums of Standard Normal Distribution')
```

In order to test our functions with various distributions, let's explore the gamma distribution. We see that for a gamma distribution with a shape of 2, the density of the sample minimums is greatest between 0 and .1. We also see that the cumulative probability of sample minimums begins to rise at 0 and reaches 100% by .4. 

```{r minimum pdf gamma, echo=FALSE}
x <- seq(-.1, .4, by = .001)
plot(x, dorder(x, n = 200, k = 1, dist = 'gamma', shape = 2), 
     type = 'l', 
     main = 'Density Plot of Sample Minimums of Gamma Distibution With Shape = 2',
     xlab = 'Minimum',
     ylab = 'Density')
```

```{r minimum cdf gamma, echo=FALSE}
curve(porder(x, n = 200, k = 1, dist = 'gamma', shape = 2),
      -.1, .4,
      xlab = 'Minimum',
      ylab = 'Probability',
      main = 'CDF of Sample Minimums of Gamma Distibution With Shape = 2')
```
